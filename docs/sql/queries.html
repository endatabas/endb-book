<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Queries - The Endatabas Book</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Introduction</a></li><li class="chapter-item expanded "><a href="../tutorial/index.html"><strong aria-hidden="true">1.</strong> Tutorial</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../tutorial/quickstart.html"><strong aria-hidden="true">1.1.</strong> Quickstart</a></li><li class="chapter-item expanded "><a href="../tutorial/try_it.html"><strong aria-hidden="true">1.2.</strong> Try It!</a></li><li class="chapter-item expanded "><a href="../tutorial/sql_basics.html"><strong aria-hidden="true">1.3.</strong> Endb SQL Basics</a></li></ol></li><li class="chapter-item expanded "><a href="../sql/index.html"><strong aria-hidden="true">2.</strong> SQL Reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../sql/data_manipulation.html"><strong aria-hidden="true">2.1.</strong> Data Manipulation</a></li><li class="chapter-item expanded "><a href="../sql/queries.html" class="active"><strong aria-hidden="true">2.2.</strong> Queries</a></li><li class="chapter-item expanded "><a href="../sql/path_navigation.html"><strong aria-hidden="true">2.3.</strong> Path Navigation</a></li><li class="chapter-item expanded "><a href="../sql/data_types.html"><strong aria-hidden="true">2.4.</strong> SQL Data Types</a></li><li class="chapter-item expanded "><a href="../sql/operators.html"><strong aria-hidden="true">2.5.</strong> Operators</a></li><li class="chapter-item expanded "><a href="../sql/functions.html"><strong aria-hidden="true">2.6.</strong> Functions</a></li></ol></li><li class="chapter-item expanded "><a href="../reference/index.html"><strong aria-hidden="true">3.</strong> Reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/installation.html"><strong aria-hidden="true">3.1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="../reference/http_api.html"><strong aria-hidden="true">3.2.</strong> HTTP API</a></li><li class="chapter-item expanded "><a href="../reference/data_types.html"><strong aria-hidden="true">3.3.</strong> Data Types</a></li></ol></li><li class="chapter-item expanded "><a href="../appendix/index.html"><strong aria-hidden="true">4.</strong> Appendix</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../appendix/architecture.html"><strong aria-hidden="true">4.1.</strong> Architecture</a></li><li class="chapter-item expanded "><a href="../appendix/roadmap.html"><strong aria-hidden="true">4.2.</strong> Roadmap</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Endatabas Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="queries"><a class="header" href="#queries">Queries</a></h1>
<p>Endb SQL strives to empower the query author.
Basic SQL queries should be familiar.
Advanced SQL queries should be simple.</p>
<h2 id="select-"><a class="header" href="#select-">Select *</a></h2>
<p>The most common hand-written SQL query tends to be the easiest:</p>
<pre><code class="language-sql">SELECT * FROM products;
</code></pre>
<p>Without a <code>WHERE</code> clause (discussed below) the entire table is returned.
Because Endb is schemaless, <code>*</code> has a special meaning.
Each document (row) in Endb carries with it its own schema.
As a result, <code>*</code> refers to the widest possible set of columns, across all the rows returned.</p>
<p>In many SQL dialects, columns are strictly ordered.
Because Endb columns cannot have a strict order, <code>*</code> returns them in alphabetical order.</p>
<h2 id="select-by-name"><a class="header" href="#select-by-name">Select By Name</a></h2>
<p>In programmatic environments, it is almost always preferable to query for specific columns by name:</p>
<pre><code class="language-sql">SELECT product_no FROM products;
</code></pre>
<p>Select a list of columns by delimiting them with commas.
If your client accepts <code>text/csv</code> as a content type, columns will be returned in the order specified.
JSON keys are inherently unordered so the order of columns is ignored for accepted content types of
<code>application/json</code>, <code>application/x-ndjson</code>, and <code>application/ld+json</code>.</p>
<pre><code class="language-sql">SELECT product_no, v, price, name FROM products;
</code></pre>
<h2 id="where-filtering"><a class="header" href="#where-filtering">Where Filtering</a></h2>
<p>Rather than returning the entire table, documents (rows) can be filtered with a <code>WHERE</code> clause.</p>
<pre><code class="language-sql">SELECT * FROM products WHERE price &gt; 4;
</code></pre>
<h3 id="comparison"><a class="header" href="#comparison">Comparison</a></h3>
<p>The most common way of filtering columns is to compare them.
Endb provides <code>=</code>, <code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&lt;=</code> operators.
These work on all column types, though comparing two disparate types may produce unexpected results.</p>
<pre><code class="language-sql">SELECT * FROM products WHERE product_no = 99;
SELECT * FROM products WHERE price &lt; 4;
SELECT * FROM products WHERE name &gt;= 'Cabin';
</code></pre>
<h3 id="aliases"><a class="header" href="#aliases">Aliases</a></h3>
<p>For convenience, tables can be given aliases immediately following their name in the <code>FROM</code> clause.</p>
<pre><code class="language-sql">SELECT p.name FROM products p;
</code></pre>
<p>This is most useful when joining tables, as seen below.</p>
<h3 id="joins"><a class="header" href="#joins">Joins</a></h3>
<p>Because Endb is schemaless, documents (rows) can be joined on any fields (columns) which have equivalent values.</p>
<pre><code class="language-sql">INSERT INTO coupons {name: 'Salt', price: 3.0};
SELECT * FROM products p JOIN coupons c ON p.name = c.name;
</code></pre>
<h3 id="as-alias-tables-expressions-and-columns"><a class="header" href="#as-alias-tables-expressions-and-columns">AS: Alias Tables, Expressions, and Columns</a></h3>
<p>The <code>AS</code> operator can optionally be used to provide an alias for a table.</p>
<pre><code class="language-sql">SELECT p.name FROM products AS p;
</code></pre>
<p>More usefully, it can give a temporary table name to an expression.
The temporary table name can either have anonymous columns or named columns.
(The <a href="/sql/queries.html#values-lists"><code>VALUES</code> keyword</a> is explained in the following
<em>VALUES Lists</em> section.)</p>
<pre><code class="language-sql">SELECT p.column1 FROM (VALUES ('Paprika', 4.77)) AS p;
SELECT p.price FROM (VALUES ('Paprika', 4.77)) AS p(name, price);
</code></pre>
<p>The <code>AS</code> keyword is also used to alias columns.
This is useful when column names conflict in a join.
If the same column is specified more than once, the last reference to that column name
is the one which will be returned:</p>
<pre><code class="language-sql">SELECT c.price, p.price FROM products p JOIN coupons c ON p.name = c.name;
</code></pre>
<p>If both columns are required, <code>AS</code> can be used to rename one or both of the columns:</p>
<pre><code class="language-sql">SELECT p.price AS regular_price, c.price FROM products p JOIN coupons c ON p.name = c.name;
</code></pre>
<h3 id="advanced-filtering"><a class="header" href="#advanced-filtering">Advanced Filtering</a></h3>
<p>More advanced filters are documented in <a href="/sql/functions_operators.html">Functions and Operators</a>.</p>
<h2 id="order-sorting-results"><a class="header" href="#order-sorting-results">Order (Sorting Results)</a></h2>
<p>Results from queries can be ordered with standard SQL <code>ORDER BY</code>.</p>
<pre><code class="language-sql">SELECT * FROM products ORDER BY price;
</code></pre>
<p>By default, ordering is ascending.
For descending order, suffix the <code>ORDER BY</code> clause with <code>DESC</code>:</p>
<pre><code class="language-sql">SELECT * FROM products ORDER BY price DESC;
</code></pre>
<p>To force ascending order, use <code>ASC</code>:</p>
<pre><code class="language-sql">SELECT * FROM products ORDER BY price ASC;
</code></pre>
<p>It is also possible to order by an expression:</p>
<pre><code class="language-sql">SELECT * FROM products ORDER BY LENGTH(name);
SELECT * FROM products ORDER BY -price;
</code></pre>
<p>In the example above, <code>LENGTH</code> is an example of a function.
A complete list of functions can be found in the <a href="/sql/functions_operators.html">Functions and Operators</a> documentation.</p>
<h2 id="limit"><a class="header" href="#limit">LIMIT</a></h2>
<p><code>LIMIT</code> specifies the maximum number of rows to be returned by the query.</p>
<pre><code class="language-sql">SELECT * FROM products LIMIT 2;
</code></pre>
<p>It always makes sense to control the order of returned rows so <code>LIMIT</code> always returns the same rows
for the same query -- unless you don't care which rows are returned.</p>
<pre><code class="language-sql">SELECT * FROM products ORDER BY price ASC LIMIT 2;
</code></pre>
<h2 id="values-lists"><a class="header" href="#values-lists">VALUES Lists</a></h2>
<p>The <code>VALUES</code> keyword is used to create a static table of documents (rows).
Each row is denoted by a pair of parentheses.
All rows must have <a href="/sql/queries.html#union-compatibility">Union Compatibility</a>
which, for Endb, means they have the same number of columns.</p>
<pre><code class="language-sql">VALUES (1, 'Salt'), (2, 'Pepper'), (3, 'Vinegar');
</code></pre>
<p>Endb assigns anonymous columns the names <code>column1</code>, <code>column2</code>, etc.
Columns can instead be given names with a
<a href="/sql/queries.html#as-alias-tables-expressions-and-columns">table alias</a>:</p>
<pre><code class="language-sql">SELECT * FROM (VALUES (1, 'Salt'), (2, 'Pepper'), (3, 'Vinegar')) AS t (product_no, name);
</code></pre>
<h2 id="set-operations-union-intersect-except"><a class="header" href="#set-operations-union-intersect-except">Set Operations: UNION, INTERSECT, EXCEPT</a></h2>
<p>The set operations union, intersection, and difference are available to the results of two queries.</p>
<h3 id="union"><a class="header" href="#union">UNION</a></h3>
<p>Append the results of one query to another.
Duplicate rows are removed.</p>
<pre><code class="language-sql">select * from products UNION select * from new_products;
</code></pre>
<p>To keep duplicate rows, use <code>UNION ALL</code>:</p>
<pre><code class="language-sql">select * from products UNION ALL select * from new_products;
</code></pre>
<h3 id="intersect"><a class="header" href="#intersect">INTERSECT</a></h3>
<p>The intersection of two queries returns results which are found in both.</p>
<pre><code class="language-sql">select * from products INTERSECT select * from new_products;
</code></pre>
<h3 id="except"><a class="header" href="#except">EXCEPT</a></h3>
<p>The difference of two queries returns only results from the first query which are not found in the second.
Another way of thinking about this is that results of the second query are removed from the first.</p>
<pre><code class="language-sql">select * from products EXCEPT select * from ignored_products;
</code></pre>
<h3 id="union-compatibility"><a class="header" href="#union-compatibility">Union-Compatibility</a></h3>
<p>&quot;Union Compatibility&quot; refers to the ability of two queries to be used in a union, intersection, or difference.
Because Endb is dynamically-typed, the only constraint on union compatibility is the number of columns returned.</p>
<p>In general, it only makes sense to use set operations on two queries which return either: (1) explicit columns, so
order and naming are respected or (2) columns with the same names, so they are guaranteed to return in order, in
the case of <code>*</code> queries.
When applying set operations to <code>*</code> queries, keep in mind that the widest column set (across the entire history of
the table) will be returned.</p>
<p>If the queries return a different number of columns, set operations will result in an error:</p>
<pre><code class="language-sql">-&gt; select * from products UNION select * from new_products;
400 Bad Request
Number of UNION left columns: 3 does not match right columns: 2
</code></pre>
<h2 id="with-queries-common-table-expressions"><a class="header" href="#with-queries-common-table-expressions">WITH Queries (Common Table Expressions)</a></h2>
<p>The <code>WITH</code> keyword is used to create <em>Common Table Expressions</em>, or CTEs.
CTEs act like temporary tables or views within the context of a query.
CTEs are used in place of a sub-select to simplify the appearance of a query.
<code>WITH</code> clauses take the form <code>WITH &lt;cte-name&gt; AS (&lt;cte-select&gt;)</code>.</p>
<pre><code class="language-sql">WITH top_margin_products AS (SELECT product_no FROM products WHERE (price - cost) &gt; 5.00)
SELECT name FROM products
WHERE product_no IN (SELECT product_no FROM top_margin_products);
</code></pre>
<h2 id="with-recursive"><a class="header" href="#with-recursive">WITH RECURSIVE</a></h2>
<p>The <code>RECURSIVE</code> keyword can be added to <code>WITH</code> to create recursive CTEs
which can refer to themselves.
Recursive CTEs will always have the form <code>&lt;initial-select&gt; UNION &lt;recursive-select&gt;</code>
or <code>&lt;initial-select&gt; UNION ALL &lt;recursive-select&gt;</code>.</p>
<p>Here is a naive example, demonstrating the recursive construction of a Fibonacci Sequence:</p>
<pre><code class="language-sql">WITH RECURSIVE fib(previous, current) AS (
  VALUES (0, 1)
    UNION ALL
  SELECT fib.current, fib.previous + fib.current
  FROM fib
  WHERE fib.previous + fib.current &lt; 5000
)
SELECT * FROM fib;
</code></pre>
<p>The most beneficial uses for <code>WITH RECURSIVE</code> are walking hierarchical and graph-shaped data sets
-- capabilities ordinary SQL lacks.
However, Endb recursive queries are also capable of solving Sudoku puzzles and constructing fractals,
<a href="https://github.com/endatabas/endb/blob/main/test/sql.lisp">as seen in the test suite</a>.
(Credit goes to SQLite's delightful
<a href="https://www.sqlite.org/lang_with.html#outlandish_recursive_query_examples">Outlandish Recursive Query Examples</a>.)</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../sql/data_manipulation.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../sql/path_navigation.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../sql/data_manipulation.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../sql/path_navigation.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
